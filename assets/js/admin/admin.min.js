var csrf_hash=$("input[name='csrf_myielts_token']").val();switch(window.location.origin){case"http://myielts.vn":var HOSTNAME="http://tourist1.vn/";break;default:var HOSTNAME="http://localhost/tourist1/"}switch(window.location.origin){case"http://tourist1.com":var HOSTNAMEADMIN="http://tourist1.com/admin";break;default:var HOSTNAMEADMIN="http://localhost/tourist1/admin"}$("#nav-product #submit-shared").css("display","none");$("#nav-product li#content-home").css("float","left");$("#content-home").css("display","none");$("#go-back").css("display","inline");$("#nav-product li#add-date").css("float","right");$("#nav-product li#add-date").click(function(){$.validator.setDefaults({ignore:":hidden:not('input')"});$("#register-form").validate({errorElement:"span",errorClass:"help-block",highlight:function(c,a,b){$(c).addClass("input-error");$(c).closest(".col-xs-12").addClass("has-errors")},unhighlight:function(c,a,b){$(c).closest(".col-xs-12").removeClass("has-errors");$(c).removeClass("input-error")},rules:{title_vi:{required:true},title_en:{required:true},parent_id_shared:{required:true}},messages:{title_vi:{required:"Tiêu đề không được trống."},title_en:{required:"Title field is required."},parent_id_shared:{required:"Vui lòng chọn danh mục cha."}}});if($("#register-form").valid()===false){if($(".col-xs-12.has-errors input").length>0&&$(".col-xs-12.has-errors input")[0].id.indexOf($("#home ul.language .active a").attr("aria-controls"))=="-1"){$("#home ul.language .active a").attr("aria-expanded","false");$("#"+$("#home ul.language .active a").attr("aria-controls")).removeClass("active");if($("#home ul.language .active a").attr("aria-controls")=="vi"){$("#home ul.language .active").removeClass("active");$("a[aria-controls=en]").parent().addClass("active");$("#home ul.language .active a").attr("aria-expanded","true");$("#en").addClass("active")}else{if($("#home ul.language .active a").attr("aria-controls")=="en"){$("#home ul.language .active").removeClass("active");$("a[aria-controls=vi]").parent().addClass("active");$("#home ul.language .active a").attr("aria-expanded","true");$("#vi").addClass("active")}}}if($("select[name=parent_id_shared]").parent().attr("class")=="col-xs-12 has-errors"){$("select[name=parent_id_shared]")[0].focus()}else{$(".col-xs-12.has-errors input")[0].focus()}return false}else{$("#nav-product li").css("display","inline");$("#go-back").css("display","none");if($(this)[0].id=="add-date"){$(this).css("display","none");$("#nav-product #submit-shared").css("display","inline")}$("#nav-product li#content-home").css("float","left");$("#nav-product #submit-shared").css("float","right")}});$("#submit-shared,#content-home").click(function(e){$.validator.addMethod("number",function(h,g){return this.optional(g)||($(".title-content-date.date").length>0)},"Bạn phải nhập số và lớn hơn 0.");$.validator.addMethod("vehicles",function(h,g){return this.optional(g)||(h>0)},"Bạn phải chọn phương tiện.");$.validator.setDefaults({ignore:":hidden:not('input')"});$("#register-form").validate({highlight:function(i,g,h){$(i).closest(".col-xs-12").addClass("has-errors");$(i).addClass("input-error")},unhighlight:function(i,g,h){$(i).closest(".col-xs-12").removeClass("has-errors");$(i).removeClass("input-error")}});$("[name^=title_date_]").each(function(g){if($(this)[0].name.indexOf("vi")!="-1"){messages="Tiêu đề không được trống."}else{messages="Title field is required."}$("[name="+$(this)[0].name+"]").rules("add",{required:true,messages:{required:messages}})});$("[name^=vehicles_]").each(function(g){$("[name="+$(this)[0].name+"]").rules("add",{vehicles:true})});if($("#content-full-date .title-content-date.date").length>0){$("[name=number]").rules("add",{required:true,number:true,messages:{required:"Bạn phải nhập số ngày của tour này."}})}if($("#register-form").valid()===false){if($($(".col-xs-12.has-errors")[0]).parents("[id^=showdatecontent_]").length>0){var f=$($(".col-xs-12.has-errors")[0]).parents("[id^=showdatecontent_]")[0].id;$("#"+f).attr({"class":"collapse in","aria-expanded":"true"});$("#"+f).parent().prev().attr("aria-expanded","true").removeClass("collapsed");subStringLast=$("#"+f+" ul.language .active a").attr("aria-controls").substring(0,$("#"+f+" ul.language .active a").attr("aria-controls").length-1);if($(".col-xs-12.has-errors input[name^=title_date_]")[0].id.indexOf(subStringLast)=="-1"&&$("#numberdate").val()>0&&$("#numberdate").val()!=""&&$($("#"+f+" [name^=vehicles_]")[0]).val()!=0){$("#"+f+" ul.language .active a").attr("aria-expanded","false");$("#"+$("#"+f+" ul.language .active a").attr("aria-controls")).removeClass("active");$("#"+f+" ul.language .active").removeClass("active");$("a[aria-controls="+$($(".col-xs-12.has-errors")[0]).parent()[0].id+"]").parent().addClass("active");$("#"+f+" ul.language .active").attr("aria-expanded","true");$("#"+$($(".col-xs-12.has-errors")[0]).parent()[0].id).addClass("active")}}if($("#numberdate").val()==""||$("#numberdate").val()==0){$("#numberdate").focus()}else{if($($("#"+f+" [name^=vehicles_]")[0]).val()==0){$($("#"+f+" [name^=vehicles_]")[0]).focus()}else{$(".col-xs-12.has-errors input[name^=title_date_]")[0].focus()}}return false}else{if($(this)[0].id!="submit-shared"){if($("#content-full-date .title-content-date.date").length==0){$("#numberdate").val("")}else{$("#numberdate").val($("#content-full-date .title-content-date.date").length)}$("#content-home").css("display","none");$("#nav-product #submit-shared").css("display","none");$("#go-back").css("display","inline");$("#nav-product #add-date").css("display","inline");return true}else{if($(".title-content-date.date").length<=0){alert("Vui lòng tạo ra một ngày của tour");return false}if(window.location.pathname.indexOf("/product/edit/")!="-1"){var b=window.location.href}else{var b=HOSTNAME+"admin/product/create"}var d=new FormData();numberdates=$(".title-content-date.date").length;for(var c=0;c<document.getElementById("image_shared").files.length;c++){d.append("image_shared[]",document.getElementById("image_shared").files[c])}for(var a=0;a<numberdates;a++){if(document.getElementById("img_date_"+a).files.length==0){d.append("dateimg[]",a)}else{d.append("dateimg[]",document.getElementById("img_date_"+a).files[0])}d.append("vehicles[]",$("#vehicles_"+a).val());d.append("datetitle_vi[]",$("#title_date_vi_"+a).val());d.append("datetitle_en[]",$("#title_date_en_"+a).val());d.append("datecontent_vi[]",tinymce.get("content_date_vi_"+a).getContent());d.append("datecontent_en[]",tinymce.get("content_date_en_"+a).getContent())}d.append("number",($(".title-content-date.date [name^=title_date_]").length));d.append("title_vi",$("#title_vi").val());d.append("title_en",$("#title_en").val());d.append("metakeywords_vi",$("#metakeywords_vi").val());d.append("metakeywords_en",$("#metakeywords_en").val());d.append("metadescription_vi",$("#metadescription_vi").val());d.append("metadescription_en",$("#metadescription_en").val());d.append("slug_shared",$("#slug_shared").val());d.append("parent_id_shared",$("#parent_id_shared").val());d.append("description_vi",$("#description_vi").val());d.append("description_en",$("#description_en").val());d.append("content_vi",tinymce.get("content_vi").getContent());d.append("content_en",tinymce.get("content_en").getContent());d.append("csrf_myielts_token",csrf_hash);$.ajax({method:"post",url:b,data:d,contentType:false,processData:false,success:function(g){console.log(g);if(g.status==200){csrf_hash=g.reponse.csrf_hash;if(g.isExisted==true){alert(g.message);window.location.href=HOSTNAMEADMIN+"/product"}}},error:function(h,g){console.log(errorHandle(h,g))}})}}});$("#button-numberdate,#append-date").click(function(){numberdates=$(".title-content-date.showdate.vi .title-content-date.date").length;if($(this).attr("id")=="append-date"){$("#numberdate").val($("#content-full-date .title-content-date.date").length+1)}var b=Number($("#numberdate").val());if(b=="NaN"||b==0){alert("Bạn phải nhập số và lớn hơn 0");$("#numberdate").val(numberdates);return false}var a=HOSTNAMEADMIN+"/product/ajax_form/"+b+"/"+$("#content-full-date .title-content-date").length/2;$.ajax({method:"get",url:a,success:function(c){$("label[id^=title_]").remove();$(document).ready(function(){tinymce.init({selector:".tinymce-area",theme:"modern",block_formats:"Paragraph=p;Header 1=h1;Header 2=h2;Header 3=h3",height:300,relative_urls:false,remove_script_host:false,forced_root_block:false,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor responsivefilemanager"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | responsivefilemanager | print preview media fullpage | forecolor backcolor emoticons",style_formats:[{title:"Bold text",inline:"b"},{title:"Red text",inline:"span",styles:{color:"#ff0000"}},{title:"Red header",block:"h1",styles:{color:"#ff0000"}},{title:"Example 1",inline:"span",classes:"example1"},{title:"Example 2",inline:"span",classes:"example2"},{title:"Table styles"},{title:"Table row 1",selector:"tr",classes:"tablerow1"}],external_filemanager_path:HOSTNAME+"filemanager/",filemanager_title:"Responsive Filemanager",external_plugins:{filemanager:HOSTNAME+"filemanager/plugin.min.js"}})});$("#content-full-date").append(c.reponse);for(var d=0;d<=$("#content-full-date .title-content-date.rm").length;d++){$($("#content-full-date .title-content-date.rm")[d]).removeClass("rm").addClass("date")}if(b<($("#content-full-date .title-content-date.date").length+$("#content-full-date .title-content-date.rm").length)){$($("#content-full-date .title-content-date.rm")).removeClass("rm").addClass("date");$(".no_border").prev().css("display","inline");for(var d=b;d<$("#content-full-date .title-content-date").length;d++){$($("#content-full-date .title-content-date.date")[b]).parents(".no_border").prev().fadeOut();$($("#content-full-date .title-content-date.date")[b]).removeClass("date").addClass("rm")}}else{$(".no_border").prev().css("display","inline");for(var d=0;d<(b-$("#content-full-date .title-content-date.date").length);d++){console.log($("#content-full-date .title-content-date.rm"));$($("#content-full-date .title-content-date.rm")[d]).parents(".no_border").prev().fadeIn();$($("#content-full-date .title-content-date.rm")[d]).css("display","block");$($("#content-full-date .title-content-date.rm")[d]).removeClass("rm").addClass("date")}}$("#content-full-date .title-content-date.date").css("display","block");$("#content-full-date .title-content-date.rm").css("display","none");$(".title-content-date.showdate .btn-margin span.remove").remove();if(b>1){$($(".title-content-date.showdate .btn-margin")[b-1]).append("<span class='col-xs-1 remove' style='float:right;padding:0px;z-index:9999;' onclick='removeDate();'><i class='glyphicon glyphicon-remove'></i></span>")}},error:function(d,c){console.log(errorHandle(d,c))}})});