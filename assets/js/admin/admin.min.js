var csrf_hash=$("input[name='csrf_diamondtour_token']").val();switch(window.location.origin){case"http://diamondtour.vn":var HOSTNAME="http://diamondtour.vn/";break;default:var HOSTNAME="http://localhost/tourist1/"}switch(window.location.origin){case"http://diamondtour.vn":var HOSTNAMEADMIN="http://diamondtour.vn/admin";break;default:var HOSTNAMEADMIN="http://localhost/tourist1/admin"}$("#box-promotion").fadeOut();if(window.location.pathname.indexOf("/product/edit/")!="-1"&&$("#promotion").is(":checked")==true){$("#box-promotion").fadeIn()}$("#promotion").click(function(){if($("#promotion").is(":checked")==true){$("#box-promotion").fadeIn()}else{$("#box-promotion").fadeOut();$("#box-promotion input").val("");$("#showpromotion").prop("checked",false)}});$("#nav-product #submit-shared").css("display","none");$("#nav-product li#content-home").css("float","left");$("#content-home").css("display","none");$("#go-back").css("display","inline");$("#nav-product li#add-date").css("float","right");$("#nav-product li#add-date").click(function(){$.validator.setDefaults({ignore:":hidden:not('.title-content-date.date input')"});$("#register-form").validate({errorElement:"span",errorClass:"help-block",highlight:function(c,a,b){$(c).addClass("input-error");$(c).closest(".col-xs-12").addClass("has-errors")},unhighlight:function(c,a,b){$(c).closest(".col-xs-12").removeClass("has-errors");$(c).removeClass("input-error")},rules:{title_vi:{required:true},title_en:{required:true},parent_id_shared:{required:true}},messages:{title_vi:{required:"Tiêu đề không được trống."},title_en:{required:"Title field is required."},parent_id_shared:{required:"Vui lòng chọn danh mục cha."}}});if($("#register-form").valid()===false){if($(".col-xs-12.has-errors input").length>0&&$(".col-xs-12.has-errors input")[0].id.indexOf($("#home ul.language .active a").attr("aria-controls"))=="-1"){$("#home ul.language .active a").attr("aria-expanded","false");$("#"+$("#home ul.language .active a").attr("aria-controls")).removeClass("active");if($("#home ul.language .active a").attr("aria-controls")=="vi"){$("#home ul.language .active").removeClass("active");$("a[aria-controls=en]").parent().addClass("active");$("#home ul.language .active a").attr("aria-expanded","true");$("#en").addClass("active")}else{if($("#home ul.language .active a").attr("aria-controls")=="en"){$("#home ul.language .active").removeClass("active");$("a[aria-controls=vi]").parent().addClass("active");$("#home ul.language .active a").attr("aria-expanded","true");$("#vi").addClass("active")}}}if($("select[name=parent_id_shared]").parent().attr("class")=="col-xs-12 has-errors"){$("select[name=parent_id_shared]")[0].focus()}else{$(".col-xs-12.has-errors input")[0].focus()}return false}else{$("#nav-product li").css("display","inline");$("#go-back").css("display","none");if($(this)[0].id=="add-date"){$(this).css("display","none");$("#nav-product #submit-shared").css("display","inline")}$("#nav-product li#content-home").css("float","left");$("#nav-product #submit-shared").css("float","right")}});$("#submit-shared,#content-home").click(function(d){$.validator.addMethod("number",function(g,f){return this.optional(f)||($(".title-content-date.date").length>0)},"Bạn phải nhập số và lớn hơn 0.");$.validator.addMethod("vehicles",function(g,f){return this.optional(f)||(g>0)},"Bạn phải chọn phương tiện.");$.validator.setDefaults({ignore:":hidden:not('.title-content-date.date input')"});$("#register-form").validate({highlight:function(h,f,g){$(h).closest(".col-xs-12").addClass("has-errors");$(h).addClass("input-error")},unhighlight:function(h,f,g){$(h).closest(".col-xs-12").removeClass("has-errors");$(h).removeClass("input-error")}});$("[name^=title_date_]").each(function(f){if($(this)[0].name.indexOf("vi")!="-1"){messages="Tiêu đề không được trống."}else{messages="Title field is required."}$("[name="+$(this)[0].name+"]").rules("add",{required:true,messages:{required:messages}})});$("[name^=vehicles_]").each(function(f){$("[name="+$(this)[0].name+"]").rules("add",{vehicles:true})});if($("#content-full-date .title-content-date.date").length>0){$("[name=number]").rules("add",{required:true,number:true,messages:{required:"Bạn phải nhập số ngày của tour này."}})}if($("#register-form").valid()===false){if($($(".col-xs-12.has-errors")[0]).parents("[id^=showdatecontent_]").length>0){var e=$($(".col-xs-12.has-errors")[0]).parents("[id^=showdatecontent_]")[0].id;$("#"+e).attr({"class":"collapse in","aria-expanded":"true"});$("#"+e).parent().prev().attr("aria-expanded","true").removeClass("collapsed");subStringLast=$("#"+e+" ul.language .active a").attr("aria-controls").substring(0,$("#"+e+" ul.language .active a").attr("aria-controls").length-1);if($(".col-xs-12.has-errors input[name^=title_date_]")[0].id.indexOf(subStringLast)=="-1"&&$("#numberdate").val()>0&&$("#numberdate").val()!=""&&$($("#"+e+" [name^=vehicles_]")[0]).val()!=0){$("#"+e+" ul.language .active a").attr("aria-expanded","false");$("#"+$("#"+e+" ul.language .active a").attr("aria-controls")).removeClass("active");$("#"+e+" ul.language .active").removeClass("active");$("a[aria-controls="+$($(".col-xs-12.has-errors")[0]).parent()[0].id+"]").parent().addClass("active");$("#"+e+" ul.language .active").attr("aria-expanded","true");$("#"+$($(".col-xs-12.has-errors")[0]).parent()[0].id).addClass("active")}}if($("#numberdate").val()==""||$("#numberdate").val()==0){$("#numberdate").focus()}else{if($($("#"+e+" [name^=vehicles_]")[0]).val()==0){$($("#"+e+" [name^=vehicles_]")[0]).focus()}else{$(".col-xs-12.has-errors input[name^=title_date_]")[0].focus()}}return false}else{if($(this)[0].id!="submit-shared"){if($("#content-full-date .title-content-date.date").length==0){$("#numberdate").val("")}else{$("#numberdate").val($("#content-full-date .title-content-date.date").length)}$("#content-home").css("display","none");$("#nav-product #submit-shared").css("display","none");$("#go-back").css("display","inline");$("#nav-product #add-date").css("display","inline");return true}else{if($(".title-content-date.date").length<=0){alert("Vui lòng tạo ra một ngày của tour");return false}if(window.location.pathname.indexOf("/product/edit/")!="-1"){var b=window.location.href}else{var b=HOSTNAME+"admin/product/create"}var c=new FormData();numberdates=$(".title-content-date.date").length;for(var a=0;a<numberdates;a++){if(document.getElementById("img_date_"+a).files.length==0){c.append("dateimg[]",a)}else{c.append("dateimg[]",document.getElementById("img_date_"+a).files[0])}c.append("vehicles[]",$("#vehicles_"+a).val());c.append("librarylocaltion[]",$("#go-place_"+a).val());c.append("datetitle_vi[]",$("#title_date_vi_"+a).val());c.append("datetitle_en[]",$("#title_date_en_"+a).val());c.append("datecontent_vi[]",tinymce.get("content_date_vi_"+a).getContent());c.append("datecontent_en[]",tinymce.get("content_date_en_"+a).getContent())}c.append("hot",$("#hot").is(":checked"));c.append("bestselling",$("#bestselling").is(":checked"));c.append("pricepromotion",$("#pricepromotion").val());c.append("showpromotion",$("#showpromotion").is(":checked"));c.append("price",$("#price").val());c.append("date",$("#datepicker").val());c.append("priceadults",$("#priceadults").val());c.append("pricechildren",$("#pricechildren").val());c.append("priceinfants",$("#priceinfants").val());c.append("percen",$("#percen").val());c.append("localtion",$("#localtion").val());c.append("image_shared",document.getElementById("image_shared").files[0]);c.append("image_localtion",document.getElementById("image_localtion").files[0]);c.append("number",($(".title-content-date.date [name^=title_date_]").length));c.append("title_vi",$("#title_vi").val());c.append("title_en",$("#title_en").val());c.append("metakeywords_vi",$("#metakeywords_vi").val());c.append("metakeywords_en",$("#metakeywords_en").val());c.append("metadescription_vi",$("#metadescription_vi").val());c.append("metadescription_en",$("#metadescription_en").val());c.append("slug_shared",$("#slug_shared").val());c.append("parent_id_shared",$("#parent_id_shared").val());c.append("description_vi",$("#description_vi").val());c.append("description_en",$("#description_en").val());c.append("content_vi",tinymce.get("content_vi").getContent());c.append("content_en",tinymce.get("content_en").getContent());c.append("tripnodes_vi",tinymce.get("tripnodes_vi").getContent());c.append("tripnodes_en",tinymce.get("tripnodes_en").getContent());c.append("detailsprice_vi",tinymce.get("detailsprice_vi").getContent());c.append("detailsprice_en",tinymce.get("detailsprice_en").getContent());c.append("csrf_diamondtour_token",csrf_hash);$.ajax({method:"post",url:b,data:c,contentType:false,processData:false,beforeSend:function(){$("#submit-shared").prop("disabled",true)},success:function(f){$("#submit-shared").removeAttr("disabled");if(f.status==200){csrf_hash=f.reponse.csrf_hash;if(f.isExisted==true){alert(f.message);if(window.location.pathname.indexOf("/product/edit/")!="-1"){$("input[name='csrf_diamondtour_token']").val(csrf_hash)}else{window.location.href=HOSTNAMEADMIN+"/product"}}}},error:function(g,f){alert(g.responseJSON.message);console.log(errorHandle(g,f));location.reload()}})}}});$("#button-numberdate,#append-date").click(function(){numberdates=$(".title-content-date.showdate.vi .title-content-date.date").length;if($(this).attr("id")=="append-date"){$("#numberdate").val($("#content-full-date .title-content-date.date").length+1)}var b=Number($("#numberdate").val());if(b=="NaN"||b==0){alert("Bạn phải nhập số và lớn hơn 0");$("#numberdate").val(numberdates);return false}var a=HOSTNAMEADMIN+"/product/ajax_form/"+b+"/"+$("#content-full-date .title-content-date").length/2;$.ajax({method:"get",url:a,success:function(c){$("label[id^=title_]").remove();$(document).ready(function(){tinymce.init({selector:".tinymce-area",theme:"modern",block_formats:"Paragraph=p;Header 1=h1;Header 2=h2;Header 3=h3",height:300,relative_urls:false,remove_script_host:false,forced_root_block:false,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor responsivefilemanager"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | responsivefilemanager | print preview media fullpage | forecolor backcolor emoticons",style_formats:[{title:"Bold text",inline:"b"},{title:"Red text",inline:"span",styles:{color:"#ff0000"}},{title:"Red header",block:"h1",styles:{color:"#ff0000"}},{title:"Example 1",inline:"span",classes:"example1"},{title:"Example 2",inline:"span",classes:"example2"},{title:"Table styles"},{title:"Table row 1",selector:"tr",classes:"tablerow1"}],external_filemanager_path:HOSTNAME+"filemanager/",filemanager_title:"Responsive Filemanager",external_plugins:{filemanager:HOSTNAME+"filemanager/plugin.min.js"}})});$("#content-full-date").append(c.reponse);for(var d=0;d<=$("#content-full-date .title-content-date.rm").length;d++){$($("#content-full-date .title-content-date.rm")[d]).removeClass("rm").addClass("date")}if(b<($("#content-full-date .title-content-date.date").length+$("#content-full-date .title-content-date.rm").length)){$($("#content-full-date .title-content-date.rm")).removeClass("rm").addClass("date");$(".no_border").prev().css("display","inline");for(var d=b;d<$("#content-full-date .title-content-date").length;d++){$($("#content-full-date .title-content-date.date")[b]).parents(".no_border").prev().fadeOut();$($("#content-full-date .title-content-date.date")[b]).removeClass("date").addClass("rm")}}else{$(".no_border").prev().css("display","inline");for(var d=0;d<(b-$("#content-full-date .title-content-date.date").length);d++){console.log($("#content-full-date .title-content-date.rm"));$($("#content-full-date .title-content-date.rm")[d]).parents(".no_border").prev().fadeIn();$($("#content-full-date .title-content-date.rm")[d]).css("display","block");$($("#content-full-date .title-content-date.rm")[d]).removeClass("rm").addClass("date")}}$("#content-full-date .title-content-date.date").css("display","block");$("#content-full-date .title-content-date.rm").css("display","none");$(".title-content-date.showdate .btn-margin span.remove").remove();if(b>1){$($(".title-content-date.showdate .btn-margin")[b-1]).append("<span class='col-xs-1 remove' style='float:right;padding:0px;z-index:9999;' onclick='removeDate();'><i class='glyphicon glyphicon-remove'></i></span>")}$(".select2").select2();$(document).off("change","[id^=paren-go-place_]").on("change","[id^=paren-go-place_]",function(){var f=$($(this)[0])[0].dataset.idlocaltion;var e=HOSTNAMEADMIN+"/product/ajax_area_selected";$.ajax({method:"post",url:e,data:{area:$($(this)[0]).val(),csrf_diamondtour_token:csrf_hash},success:function(g){console.log(g);csrf_hash=g.reponse.csrf_hash;if(g.status==200&&g.isExisted==true){$("input[name='csrf_diamondtour_token']").val(csrf_hash);$("#go-place_"+f).html(g.reponse.content)}},error:function(h,g){console.log(errorHandle(h,g));location.reload()}})})},error:function(d,c){console.log(errorHandle(d,c))}})});